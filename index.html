<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Caixa Freitas v9.0 Premium</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{--primary:#4a1a2e;--primary-dark:#2d0f1c;--primary-light:#6b2843;--error:#E53935;--warning:#FF9800;--success:#28a745;--text:#2c3e50;--text-light:#6c757d;--border:#dee2e6;--shadow:0 8px 32px rgba(0,0,0,0.12);--radius:16px;--radius-sm:12px;--spacing:16px}
    
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeInScale{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
    @keyframes slideInRight{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:translateX(0)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
    @keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
    @keyframes glow{0%,100%{box-shadow:0 0 20px rgba(74,26,46,0.3)}50%{box-shadow:0 0 40px rgba(74,26,46,0.6)}}
    @keyframes ripple{to{transform:scale(4);opacity:0}}
    
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none;-webkit-user-select:none}
    
    html{height:100vh;overflow:hidden;-webkit-text-size-adjust:100%;touch-action:manipulation}
    
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#1a1a2e;color:var(--text);overflow:hidden;height:100vh;position:fixed;width:100%;display:flex;flex-direction:column;touch-action:pan-y}
    
    body::before{content:'';position:fixed;inset:0;background:radial-gradient(circle at 20% 50%, rgba(74,26,46,0.3) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(107,40,67,0.3) 0%, transparent 50%);pointer-events:none;z-index:0}
    
    button{cursor:pointer;transition:all .3s cubic-bezier(0.4,0,0.2,1);touch-action:manipulation;position:relative;overflow:hidden}
    
    button::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transform:translate(-50%,-50%);transition:width .6s,height .6s}
    
    button:active::before{width:300px;height:300px}
    
    button:active{transform:scale(0.97)}
    
    .turn-selection{position:fixed;inset:0;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;color:white;padding:20px;animation:fadeInScale .6s cubic-bezier(0.4,0,0.2,1)}
    
    .turn-selection::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");pointer-events:none}
    
    .turn-logo{width:90px;height:90px;background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);border:2px solid rgba(255,255,255,0.3);border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2.8rem;font-weight:800;color:white;margin-bottom:24px;animation:float 3s ease-in-out infinite;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
    
    .turn-title{font-size:2rem;font-weight:800;margin-bottom:12px;text-align:center;animation:fadeInUp .6s cubic-bezier(0.4,0,0.2,1) .2s backwards;text-shadow:0 4px 20px rgba(0,0,0,0.3)}
    
    .turn-subtitle{font-size:1.05rem;opacity:.9;margin-bottom:36px;text-align:center;animation:fadeInUp .6s cubic-bezier(0.4,0,0.2,1) .3s backwards}
    
    .turn-buttons{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;animation:fadeInUp .6s cubic-bezier(0.4,0,0.2,1) .4s backwards}
    
    .turn-btn{background:rgba(255,255,255,0.15);backdrop-filter:blur(20px);border:2px solid rgba(255,255,255,0.25);color:white;padding:20px 28px;border-radius:var(--radius);font-size:1.15rem;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:12px;min-width:170px;justify-content:center;box-shadow:0 8px 32px rgba(0,0,0,0.2);transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    
    .turn-btn:hover{background:rgba(255,255,255,0.25);transform:translateY(-2px);box-shadow:0 12px 48px rgba(0,0,0,0.3)}
    
    .turn-btn:active{transform:scale(0.98) translateY(0);box-shadow:0 4px 16px rgba(0,0,0,0.2)}
    
    #mainApp{display:none;flex-direction:column;height:100vh;position:relative;z-index:1}
    
    #mainApp.show{animation:fadeInScale .5s cubic-bezier(0.4,0,0.2,1)}
    
    .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;padding:12px var(--spacing);box-shadow:0 8px 32px rgba(74,26,46,0.3);border-radius:0 0 20px 20px;flex-shrink:0;text-align:center;position:relative;overflow:hidden}
    
    .header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,0.1),transparent);animation:shimmer 3s infinite;background-size:200% 100%}
    
    .header h1{font-size:1.5rem;font-weight:800;margin:0;text-shadow:0 2px 10px rgba(0,0,0,0.2)}
    
    .turno-info{font-size:.8rem;opacity:.95;display:flex;align-items:center;justify-content:center;gap:6px;background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);padding:4px 12px;border-radius:12px;margin-top:8px;border:1px solid rgba(255,255,255,0.3)}
    
    .container{max-width:420px;margin:0 auto;padding:8px;flex:1;overflow:hidden;display:flex;flex-direction:column;gap:10px;min-height:0}
    
    .card{background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:var(--radius);padding:14px;box-shadow:0 8px 32px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.5);flex-shrink:0;animation:fadeInUp .5s cubic-bezier(0.4,0,0.2,1);position:relative}
    
    .card::before{content:'';position:absolute;inset:0;border-radius:var(--radius);background:linear-gradient(135deg,rgba(255,255,255,0.8),rgba(255,255,255,0.4));opacity:0;transition:opacity .3s;pointer-events:none}
    
    .card:hover::before{opacity:1}
    
    .section-title{font-size:1rem;font-weight:800;margin-bottom:12px;color:var(--text);display:flex;align-items:center;gap:8px}
    
    .section-title i{font-size:1.1rem;color:var(--primary)}
    
    .products-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    
    .product-btn{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;border:none;border-radius:var(--radius-sm);padding:18px 12px;font-size:.95rem;font-weight:700;box-shadow:0 4px 16px rgba(74,26,46,0.3);min-height:70px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;position:relative;overflow:hidden}
    
    .product-btn::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .5s}
    
    .product-btn:hover::after{left:100%}
    
    .product-btn:active{animation:pulse .3s}
    
    .product-btn .price{font-size:.8rem;opacity:.95;font-weight:600}
    
    .others-btn{background:linear-gradient(135deg,var(--warning) 0%,#F57C00 100%);position:relative}
    
    .others-btn::before{content:'+';position:absolute;top:8px;right:12px;font-size:1.3rem;font-weight:bold;animation:pulse 2s infinite}
    
    .summary-section{flex:1;display:flex;flex-direction:column;min-height:0}
    
    .summary-list{min-height:120px;max-height:200px;overflow-y:auto;margin-bottom:12px;border:1px solid rgba(222,226,230,0.5);border-radius:var(--radius-sm);padding:8px;background:rgba(248,249,250,0.5);backdrop-filter:blur(10px)}
    
    .summary-list::-webkit-scrollbar{width:6px}
    .summary-list::-webkit-scrollbar-track{background:rgba(0,0,0,0.05);border-radius:10px}
    .summary-list::-webkit-scrollbar-thumb{background:var(--primary);border-radius:10px}
    
    .summary-item{display:grid;grid-template-columns:1fr auto auto;align-items:center;gap:10px;padding:12px;margin-bottom:6px;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);border-radius:var(--radius-sm);cursor:pointer;border:1px solid rgba(0,0,0,0.08);box-shadow:0 2px 8px rgba(0,0,0,0.08);animation:slideInRight .4s cubic-bezier(0.4,0,0.2,1);transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    
    .summary-item:hover{transform:translateX(-3px);box-shadow:0 4px 16px rgba(0,0,0,0.15)}
    
    .summary-item:active{transform:scale(0.98)}
    
    .summary-item.is-others{background:linear-gradient(135deg,rgba(255,249,196,0.9),rgba(255,245,157,0.9));border-color:rgba(255,152,0,0.3)}
    
    .summary-item.removing{animation:slideOutRight .4s cubic-bezier(0.4,0,0.2,1) forwards}
    
    @keyframes slideOutRight{to{opacity:0;transform:translateX(100%)}}
    
    .item-info{display:flex;flex-direction:column;gap:3px}
    
    .item-label{font-weight:700;font-size:.9rem;color:var(--text)}
    
    .item-quantity{font-size:.8rem;color:var(--text-light);font-weight:600}
    
    .item-price{font-weight:800;color:var(--primary);font-size:.95rem}
    
    .delete-btn{background:none;border:none;color:var(--error);padding:8px;border-radius:50%;width:36px;height:36px;font-size:.9rem;z-index:10;transition:all .3s}
    
    .delete-btn:hover{background:rgba(229,57,53,0.1);transform:rotate(90deg) scale(1.1)}
    
    .delete-btn:active{background:rgba(229,57,53,0.2)}
    
    .empty-cart{text-align:center;padding:24px 10px;color:var(--text-light);animation:fadeInScale .5s cubic-bezier(0.4,0,0.2,1)}
    
    .empty-cart i{font-size:2.5rem;margin-bottom:12px;opacity:.3;animation:float 3s ease-in-out infinite}
    
    .total-amount{font-size:1.5rem;font-weight:900;color:var(--primary);text-align:center;margin-bottom:14px;border:2px solid var(--primary);border-radius:var(--radius-sm);padding:12px;background:linear-gradient(135deg,rgba(255,255,255,0.9),rgba(248,249,250,0.9));backdrop-filter:blur(10px);box-shadow:0 4px 16px rgba(74,26,46,0.1);transition:all .3s}
    
    .total-amount.updating{animation:pulse .5s}
    
    .payment-methods{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
    
    .payment-btn{background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);color:var(--text);border:2px solid rgba(222,226,230,0.6);border-radius:var(--radius-sm);padding:14px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.08);font-size:.95rem;min-height:54px;transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    
    .payment-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.12)}
    
    .payment-btn.selected{background:linear-gradient(135deg,var(--success) 0%,#218838 100%);color:white;border-color:var(--success);transform:scale(1.03);box-shadow:0 8px 24px rgba(40,167,69,0.4);animation:glow 2s infinite}
    
    .payment-btn:active:not(.selected){transform:scale(0.98)}
    
    .received-section{margin-bottom:14px;opacity:0;transform:translateY(-10px);transition:all .4s cubic-bezier(0.4,0,0.2,1);display:none}
    
    .received-section.show{opacity:1;transform:translateY(0);display:block;animation:fadeInUp .4s cubic-bezier(0.4,0,0.2,1)}
    
    .received-input{width:100%;padding:14px;font-size:1.3rem;border:2px solid rgba(249,168,37,0.5);border-radius:var(--radius-sm);text-align:center;background:linear-gradient(135deg,rgba(255,249,196,0.9),rgba(255,245,157,0.9));backdrop-filter:blur(10px);font-weight:800;cursor:pointer;box-shadow:0 4px 16px rgba(255,152,0,0.2);transition:all .3s}
    
    .received-input:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(255,152,0,0.3)}
    
    .change-amount{text-align:center;font-size:1.15rem;font-weight:800;color:var(--success);margin-top:10px;display:none;animation:fadeInUp .3s cubic-bezier(0.4,0,0.2,1)}
    
    .action-buttons{display:grid;grid-template-columns:2fr 1fr 1fr;gap:10px;margin-bottom:14px}
    
    .action-buttons-row2{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}
    
    .action-btn{padding:14px 10px;border:none;border-radius:var(--radius-sm);font-size:.9rem;font-weight:800;display:flex;align-items:center;justify-content:center;gap:6px;box-shadow:0 4px 16px rgba(0,0,0,0.15);min-height:54px;transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,0.2)}
    
    .next-btn{background:linear-gradient(135deg,var(--success) 0%,#218838 100%);color:white;font-size:1rem;font-weight:900;box-shadow:0 6px 24px rgba(40,167,69,0.4)}
    
    .next-btn:hover{box-shadow:0 8px 32px rgba(40,167,69,0.5);animation:glow 1s infinite}
    
    .clear-btn{background:linear-gradient(135deg,var(--error) 0%,#d32f2f 100%);color:white}
    
    .payment-supplier-btn{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;font-size:.8rem}
    
    .sangria-btn{background:linear-gradient(135deg,var(--warning) 0%,#F57C00 100%);color:white;font-size:.8rem}
    
    .close-turn-btn{background:linear-gradient(135deg,var(--text-light) 0%,#424242 100%);color:white;font-size:.8rem}
    
    .history-btn{background:linear-gradient(135deg,var(--text-light) 0%,#424242 100%);color:white;padding:12px;border:none;border-radius:var(--radius-sm);font-weight:700;display:flex;align-items:center;justify-content:center;gap:6px;box-shadow:0 4px 16px rgba(0,0,0,0.15);font-size:.85rem;min-height:54px}
    
    .history-btn.pro{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%)}
    
    .virtual-keyboard{position:fixed;inset:0;background:rgba(26,26,46,0.95);backdrop-filter:blur(30px);padding:20px;z-index:2000;display:none;justify-content:center;align-items:center}
    
    .virtual-keyboard.show{display:flex;animation:fadeInScale .4s cubic-bezier(0.4,0,0.2,1)}
    
    .keyboard-container{background:rgba(255,255,255,0.98);backdrop-filter:blur(20px);border-radius:24px;padding:24px;width:100%;max-width:400px;box-shadow:0 20px 80px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.5);animation:fadeInUp .5s cubic-bezier(0.4,0,0.2,1)}
    
    .keyboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid rgba(222,226,230,0.5)}
    
    .keyboard-title{font-weight:800;color:var(--text);font-size:1.15rem}
    
    .keyboard-close{background:linear-gradient(135deg,var(--error),#d32f2f);border:none;color:white;font-size:1.3rem;padding:8px 12px;border-radius:10px;font-weight:bold;box-shadow:0 4px 12px rgba(229,57,53,0.3)}
    
    .keyboard-display{background:linear-gradient(135deg,rgba(255,249,196,0.9),rgba(255,245,157,0.9));backdrop-filter:blur(10px);padding:18px;border-radius:var(--radius-sm);font-size:2rem;font-weight:900;text-align:center;margin-bottom:20px;border:3px solid rgba(249,168,37,0.5);min-height:75px;display:flex;align-items:center;justify-content:center;color:var(--primary);box-shadow:0 4px 16px rgba(255,152,0,0.2)}
    
    .keyboard-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
    
    .keyboard-btn{aspect-ratio:1;font-size:1.5rem;font-weight:800;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;box-shadow:0 4px 16px rgba(74,26,46,0.3);min-height:64px;display:flex;align-items:center;justify-content:center;transition:all .2s cubic-bezier(0.4,0,0.2,1)}
    
    .keyboard-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(74,26,46,0.4)}
    
    .keyboard-btn:active{transform:scale(0.95);box-shadow:0 2px 8px rgba(74,26,46,0.3)}
    
    .keyboard-actions{display:grid;grid-template-columns:1fr 2fr;gap:12px}
    
    .keyboard-cancel,.keyboard-confirm{border:none;border-radius:var(--radius-sm);padding:18px;font-weight:800;font-size:1.05rem;transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    
    .keyboard-cancel{background:linear-gradient(135deg,var(--error),#d32f2f);color:white;box-shadow:0 4px 16px rgba(229,57,53,0.3)}
    
    .keyboard-confirm{background:linear-gradient(135deg,var(--success),#218838);color:white;box-shadow:0 4px 16px rgba(40,167,69,0.3)}
    
    .keyboard-cancel:hover,.keyboard-confirm:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,0.3)}
    
    .notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.98);backdrop-filter:blur(20px);border-radius:var(--radius);padding:18px 24px;box-shadow:0 8px 32px rgba(0,0,0,0.2);z-index:3000;display:none;align-items:center;gap:14px;min-width:300px;max-width:90vw;border:1px solid rgba(255,255,255,0.5)}
    
    .notification.show{display:flex;animation:slideInDown .5s cubic-bezier(0.4,0,0.2,1)}
    
    @keyframes slideInDown{from{opacity:0;transform:translate(-50%,-100%)}to{opacity:1;transform:translate(-50%,0)}}
    
    .notification.error{border-left:4px solid var(--error);background:rgba(253,242,242,0.98)}
    
    .notification.warning{border-left:4px solid var(--warning);background:rgba(255,251,240,0.98)}
    
    .notification.success{border-left:4px solid var(--success);background:rgba(232,245,233,0.98)}
    
    .notification-icon{font-size:1.5rem;animation:pulse 1s infinite}
    
    .notification.error .notification-icon{color:var(--error)}
    
    .notification.warning .notification-icon{color:var(--warning)}
    
    .notification.success .notification-icon{color:var(--success)}
    
    .notification-message{flex:1;font-weight:700;font-size:1rem}
    
    .notification-close{background:none;border:none;font-size:1.2rem;color:var(--text-light);padding:6px;border-radius:6px;transition:all .2s}
    
    .notification-close:hover{background:rgba(0,0,0,0.05);transform:scale(1.1)}
  </style>
</head>
<body>
  <div class="turn-selection" id="turnSelection">
    <div class="turn-logo">F</div>
    <h2 class="turn-title">Bem-vindo ao Caixa Freitas</h2>
    <p class="turn-subtitle">Selecione o turno para come√ßar</p>
    <div class="turn-buttons">
      <button class="turn-btn" onclick="startTurn('morning')">
        <span>‚òÄÔ∏è</span> Turno da Manh√£
      </button>
      <button class="turn-btn" onclick="startTurn('afternoon')">
        <span>üåÖ</span> Turno da Tarde
      </button>
    </div>
  </div>

  <div id="mainApp">
    <header class="header">
      <h1>Caixa Freitas</h1>
      <div class="turno-info" id="turnInfo">
        <i class="fas fa-clock"></i>
        <span id="turnText">Carregando...</span>
      </div>
    </header>

    <div class="container">
      <section class="card">
        <h3 class="section-title">
          <i class="fas fa-bread-slice"></i> Produtos
        </h3>
        <div class="products-grid">
          <button class="product-btn" onclick="addProduct('P√£o de Sal', 0.70)">
            <span>P√£o de Sal</span>
            <span class="price">R$ 0,70</span>
          </button>
          <button class="product-btn" onclick="addProduct('P√£o Doce Comum', 0.70)">
            <span>P√£o Doce Comum</span>
            <span class="price">R$ 0,70</span>
          </button>
          <button class="product-btn" onclick="addProduct('P√£o Doce Especial', 0.80)">
            <span>P√£o Doce Especial</span>
            <span class="price">R$ 0,80</span>
          </button>
          <button class="product-btn others-btn" onclick="openKeyboard('others')">
            <span>Outros</span>
          </button>
        </div>
      </section>

      <section class="card summary-section">
        <h3 class="section-title">
          <i class="fas fa-shopping-cart"></i> Pedido
        </h3>
        <div class="summary-list" id="summaryList">
          <div class="empty-cart">
            <i class="fas fa-shopping-cart"></i>
            <p>Nenhum item adicionado</p>
          </div>
        </div>
        <div class="total-section">
          <div class="total-amount" id="totalAmountDiv">
            Total: <span id="totalAmount">R$ 0,00</span>
          </div>
          <div class="payment-section">
            <h4 class="section-title">
              <i class="fas fa-credit-card"></i> Pagamento
            </h4>
            <div class="payment-methods">
              <button class="payment-btn" onclick="selectPayment('Cash')">
                <i class="fas fa-money-bill-wave"></i> Dinheiro
              </button>
              <button class="payment-btn" onclick="selectPayment('Card/PIX')">
                <i class="fas fa-credit-card"></i> Cart√£o/PIX
              </button>
            </div>
          </div>
          <div class="received-section" id="receivedSection">
            <input type="text" class="received-input" id="receivedInput" 
                   placeholder="Valor recebido" readonly onclick="openReceivedKeyboard()">
            <div class="change-amount" id="changeAmount"></div>
          </div>
          <div class="action-buttons">
            <button class="action-btn next-btn" onclick="processNext()">
              <i class="fas fa-check"></i> Pr√≥ximo Cliente
            </button>
            <button class="action-btn clear-btn" onclick="clearCart()">
              <i class="fas fa-trash"></i> Limpar
            </button>
            <button class="action-btn payment-supplier-btn" onclick="showNotification('Em desenvolvimento', 'warning')">
              <i class="fas fa-hand-holding-usd"></i> Pagamento
            </button>
          </div>
          <div class="action-buttons-row2">
            <button class="action-btn sangria-btn" onclick="showNotification('Em desenvolvimento', 'warning')">
              <i class="fas fa-money-bill-wave"></i> Sangria
            </button>
            <button class="action-btn close-turn-btn" onclick="closeTurn()">
              <i class="fas fa-times"></i> Fechar
            </button>
            <button class="action-btn history-btn" onclick="showNotification('Em desenvolvimento', 'warning')">
              <i class="fas fa-history"></i> Hist√≥rico
            </button>
            <button class="action-btn history-btn pro" onclick="showNotification('Em desenvolvimento', 'warning')">
              <i class="fas fa-chart-line"></i> Pro
            </button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="virtual-keyboard" id="virtualKeyboard">
    <div class="keyboard-container">
      <div class="keyboard-header">
        <span class="keyboard-title" id="keyboardTitle">Inserir valor</span>
        <button class="keyboard-close" onclick="closeKeyboard()">√ó</button>
      </div>
      <div class="keyboard-display" id="keyboardDisplay">0</div>
      <div class="keyboard-grid">
        <button class="keyboard-btn" onclick="inputDigit('1')">1</button>
        <button class="keyboard-btn" onclick="inputDigit('2')">2</button>
        <button class="keyboard-btn" onclick="inputDigit('3')">3</button>
        <button class="keyboard-btn" onclick="inputDigit('4')">4</button>
        <button class="keyboard-btn" onclick="inputDigit('5')">5</button>
        <button class="keyboard-btn" onclick="inputDigit('6')">6</button>
        <button class="keyboard-btn" onclick="inputDigit('7')">7</button>
        <button class="keyboard-btn" onclick="inputDigit('8')">8</button>
        <button class="keyboard-btn" onclick="inputDigit('9')">9</button>
        <button class="keyboard-btn" onclick="inputComma()">,</button>
        <button class="keyboard-btn" onclick="inputDigit('0')">0</button>
        <button class="keyboard-btn" onclick="backspace()">
          <i class="fas fa-backspace"></i>
        </button>
      </div>
      <div class="keyboard-actions">
        <button class="keyboard-cancel" onclick="closeKeyboard()">Cancelar</button>
        <button class="keyboard-confirm" onclick="confirmKeyboard()">Confirmar</button>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="notification-icon fas fa-exclamation-triangle"></i>
    <span class="notification-message" id="notificationMessage">Mensagem</span>
    <button class="notification-close" onclick="hideNotification()">√ó</button>
  </div>

  <script>
    // Estado global
    let cart = [];
    let total = 0;
    let paymentMethod = '';
    let currentTurn = null;
    let keyboardValue = '';
    let keyboardTarget = null;
    let editIndex = null;
    let isFirstDigit = false;

    // Iniciar turno
    function startTurn(type) {
      const now = new Date();
      currentTurn = {
        type: type,
        startTime: now.toLocaleTimeString('pt-BR'),
        startDate: now.toLocaleDateString('pt-BR')
      };
      
      localStorage.setItem('activeTurn', JSON.stringify(currentTurn));
      
      document.getElementById('turnSelection').style.display = 'none';
      const mainApp = document.getElementById('mainApp');
      mainApp.style.display = 'flex';
      mainApp.classList.add('show');
      
      updateTurnInfo();
      loadCart();
    }

    // Atualizar informa√ß√µes do turno
    function updateTurnInfo() {
      if (!currentTurn) return;
      
      const emoji = currentTurn.type === 'morning' ? '‚òÄÔ∏è' : 'üåÖ';
      const name = currentTurn.type === 'morning' ? 'Manh√£' : 'Tarde';
      
      document.getElementById('turnText').textContent = 
        `${emoji} Turno da ${name} - ${currentTurn.startTime}`;
    }

    // Adicionar produto com anima√ß√£o
    function addProduct(label, price) {
      const existing = cart.find(item => 
        item.label === label && item.price === price
      );
      
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({
          label,
          price,
          quantity: 1,
          isOthers: label === 'Outros'
        });
      }
      
      updateDisplay();
    }

    // Remover item com anima√ß√£o
    function removeItem(index) {
      const items = document.querySelectorAll('.summary-item');
      const reversedCart = [...cart].reverse();
      const displayIndex = reversedCart.findIndex((item, i) => cart.length - 1 - i === index);
      
      if (items[displayIndex]) {
        items[displayIndex].classList.add('removing');
        setTimeout(() => {
          cart.splice(index, 1);
          updateDisplay();
        }, 400);
      } else {
        cart.splice(index, 1);
        updateDisplay();
      }
    }

    // Atualizar display
    function updateDisplay() {
      renderCart();
      updateTotal();
      saveCart();
    }

    // Renderizar carrinho
    function renderCart() {
      const list = document.getElementById('summaryList');
      
      if (cart.length === 0) {
        list.innerHTML = `
          <div class="empty-cart">
            <i class="fas fa-shopping-cart"></i>
            <p>Nenhum item adicionado</p>
          </div>
        `;
        return;
      }
      
      const reversedCart = [...cart].reverse();
      
      list.innerHTML = reversedCart.map((item, displayIndex) => {
        const realIndex = cart.length - 1 - displayIndex;
        
        return `
          <div class="summary-item ${item.isOthers ? 'is-others' : ''}" onclick="editItem(${realIndex})">
            <div class="item-info">
              <div class="item-label">${item.label}</div>
              <div class="item-quantity">
                ${item.quantity}x R$ ${item.price.toFixed(2).replace('.', ',')}
              </div>
            </div>
            <div class="item-price">
              R$ ${(item.quantity * item.price).toFixed(2).replace('.', ',')}
            </div>
            <button class="delete-btn" onclick="event.stopPropagation(); removeItem(${realIndex})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
      }).join('');
    }

    // Atualizar total com anima√ß√£o
    function updateTotal() {
      total = cart.reduce((sum, item) => sum + (item.quantity * item.price), 0);
      
      const totalDiv = document.getElementById('totalAmountDiv');
      totalDiv.classList.add('updating');
      setTimeout(() => totalDiv.classList.remove('updating'), 500);
      
      document.getElementById('totalAmount').textContent = 
        `R$ ${total.toFixed(2).replace('.', ',')}`;
      
      if (paymentMethod === 'Card/PIX') {
        document.getElementById('receivedInput').value = 
          total.toFixed(2).replace('.', ',');
      }
      
      if (paymentMethod === 'Cash') {
        updateChange();
      }
    }

    // Selecionar m√©todo de pagamento
    function selectPayment(method) {
      paymentMethod = method;
      
      document.querySelectorAll('.payment-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
      
      const section = document.getElementById('receivedSection');
      const input = document.getElementById('receivedInput');
      const change = document.getElementById('changeAmount');
      
      section.classList.add('show');
      
      if (method === 'Card/PIX') {
        input.value = total.toFixed(2).replace('.', ',');
        input.style.background = 'linear-gradient(135deg, rgba(232,245,232,0.9), rgba(200,230,201,0.9))';
        change.style.display = 'none';
      } else {
        input.value = '';
        input.style.background = 'linear-gradient(135deg, rgba(255,249,196,0.9), rgba(255,245,157,0.9))';
        change.style.display = 'block';
      }
    }

    // Atualizar troco
    function updateChange() {
      const input = document.getElementById('receivedInput');
      const change = document.getElementById('changeAmount');
      const received = parseFloat(input.value.replace(',', '.')) || 0;
      const diff = received - total;
      
      if (diff >= 0) {
        change.textContent = `Troco: R$ ${diff.toFixed(2).replace('.', ',')}`;
        change.style.color = 'var(--success)';
      } else {
        change.textContent = `Falta: R$ ${Math.abs(diff).toFixed(2).replace('.', ',')}`;
        change.style.color = 'var(--error)';
      }
    }

    // Limpar carrinho
    function clearCart() {
      if (!confirm('Deseja limpar todo o carrinho?')) return;
      
      cart = [];
      total = 0;
      paymentMethod = '';
      
      updateDisplay();
      
      document.querySelectorAll('.payment-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      document.getElementById('receivedSection').classList.remove('show');
      document.getElementById('receivedInput').value = '';
      document.getElementById('changeAmount').textContent = '';
    }

    // Processar pr√≥ximo cliente
    function processNext() {
      if (cart.length === 0) {
        showNotification('Adicione itens ao carrinho', 'warning');
        return;
      }
      
      if (!paymentMethod) {
        showNotification('Selecione a forma de pagamento', 'warning');
        return;
      }
      
      let received = total;
      
      if (paymentMethod === 'Cash') {
        const input = document.getElementById('receivedInput');
        if (!input.value) {
          showNotification('Informe o valor recebido', 'warning');
          return;
        }
        
        received = parseFloat(input.value.replace(',', '.')) || 0;
        
        if (received < total) {
          showNotification('Valor recebido √© menor que o total', 'error');
          return;
        }
      }
      
      saveSale(received);
      clearCartSilent();
      showNotification('Venda processada com sucesso!', 'success');
    }

    // Limpar carrinho silenciosamente
    function clearCartSilent() {
      cart = [];
      total = 0;
      paymentMethod = '';
      
      updateDisplay();
      
      document.querySelectorAll('.payment-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      document.getElementById('receivedSection').classList.remove('show');
      document.getElementById('receivedInput').value = '';
      document.getElementById('changeAmount').textContent = '';
    }

    // Salvar venda
    function saveSale(received) {
      const now = new Date();
      const sale = {
        id: Date.now(),
        items: [...cart],
        total: total,
        paymentMethod: paymentMethod,
        received: received,
        change: received - total,
        timestamp: now.toISOString(),
        date: now.toLocaleDateString('pt-BR'),
        time: now.toLocaleTimeString('pt-BR'),
        turn: currentTurn
      };
      
      const history = JSON.parse(localStorage.getItem('salesHistory') || '[]');
      history.unshift(sale);
      localStorage.setItem('salesHistory', JSON.stringify(history));
    }

    // Salvar carrinho
    function saveCart() {
      localStorage.setItem('currentCart', JSON.stringify(cart));
    }

    // Carregar carrinho
    function loadCart() {
      const saved = localStorage.getItem('currentCart');
      if (saved) {
        cart = JSON.parse(saved);
        updateDisplay();
      }
    }

    // Fechar turno
    function closeTurn() {
      if (!confirm('Deseja realmente fechar o turno atual?')) return;
      
      const now = new Date();
      const closed = {
        ...currentTurn,
        endTime: now.toLocaleTimeString('pt-BR'),
        endDate: now.toLocaleDateString('pt-BR'),
        closed: true
      };
      
      const history = JSON.parse(localStorage.getItem('turnHistory') || '[]');
      history.unshift(closed);
      localStorage.setItem('turnHistory', JSON.stringify(history));
      
      localStorage.removeItem('activeTurn');
      localStorage.removeItem('currentCart');
      
      clearCartSilent();
      
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('turnSelection').style.display = 'flex';
      
      showNotification('Turno fechado com sucesso!', 'success');
    }

    // Abrir teclado virtual
    function openKeyboard(target) {
      keyboardTarget = target;
      keyboardValue = '';
      editIndex = null;
      isFirstDigit = true;
      
      const title = target === 'others' ? 'Inserir pre√ßo do produto' : 'Inserir valor';
      document.getElementById('keyboardTitle').textContent = title;
      document.getElementById('keyboardDisplay').textContent = '0';
      document.getElementById('virtualKeyboard').classList.add('show');
    }

    // Abrir teclado para valor recebido
    function openReceivedKeyboard() {
      if (paymentMethod === 'Cash') {
        openKeyboard('received');
        document.getElementById('keyboardTitle').textContent = 'Inserir valor recebido';
      }
    }

    // Fechar teclado
    function closeKeyboard() {
      document.getElementById('virtualKeyboard').classList.remove('show');
      keyboardValue = '';
      keyboardTarget = null;
      editIndex = null;
      isFirstDigit = false;
    }

    // Inserir d√≠gito
    function inputDigit(digit) {
      if (isFirstDigit) {
        keyboardValue = '';
        isFirstDigit = false;
      }
      
      keyboardValue += digit;
      updateKeyboardDisplay();
    }

    // Inserir v√≠rgula
    function inputComma() {
      if (isFirstDigit) {
        keyboardValue = '0';
        isFirstDigit = false;
      }
      
      if (!keyboardValue.includes(',') && keyboardValue.length > 0) {
        keyboardValue += ',';
        updateKeyboardDisplay();
      }
    }

    // Backspace
    function backspace() {
      keyboardValue = keyboardValue.slice(0, -1);
      updateKeyboardDisplay();
      
      if (keyboardValue === '') {
        isFirstDigit = true;
      }
    }

    // Atualizar display do teclado
    function updateKeyboardDisplay() {
      document.getElementById('keyboardDisplay').textContent = keyboardValue || '0';
    }

    // Confirmar teclado
    function confirmKeyboard() {
      const value = parseFloat(keyboardValue.replace(',', '.'));
      
      if (isNaN(value) || value <= 0) {
        showNotification('Insira um valor v√°lido', 'warning');
        return;
      }
      
      if (keyboardTarget === 'others') {
        addProduct('Outros', value);
      } else if (keyboardTarget === 'received') {
        document.getElementById('receivedInput').value = value.toFixed(2).replace('.', ',');
        updateChange();
      } else if (keyboardTarget === 'edit-quantity') {
        const qty = parseInt(keyboardValue);
        if (qty > 0 && editIndex !== null) {
          cart[editIndex].quantity = qty;
          updateDisplay();
        }
      } else if (keyboardTarget === 'edit-price') {
        if (value > 0 && editIndex !== null) {
          cart[editIndex].price = value;
          updateDisplay();
        }
      }
      
      closeKeyboard();
    }

    // Editar item
    function editItem(index) {
      const item = cart[index];
      if (!item) return;
      
      editIndex = index;
      isFirstDigit = true;
      
      if (item.isOthers) {
        keyboardTarget = 'edit-price';
        keyboardValue = item.price.toFixed(2).replace('.', ',');
        document.getElementById('keyboardTitle').textContent = 'Editar pre√ßo: Outros';
        document.getElementById('keyboardDisplay').textContent = keyboardValue;
      } else {
        keyboardTarget = 'edit-quantity';
        keyboardValue = item.quantity.toString();
        document.getElementById('keyboardTitle').textContent = 'Editar quantidade: ' + item.label;
        document.getElementById('keyboardDisplay').textContent = keyboardValue;
      }
      
      document.getElementById('virtualKeyboard').classList.add('show');
    }

    // Mostrar notifica√ß√£o
    function showNotification(msg, type) {
      const notif = document.getElementById('notification');
      const icon = notif.querySelector('.notification-icon');
      
      notif.className = 'notification ' + type + ' show';
      
      if (type === 'error') {
        icon.className = 'notification-icon fas fa-times-circle';
      } else if (type === 'warning') {
        icon.className = 'notification-icon fas fa-exclamation-triangle';
      } else {
        icon.className = 'notification-icon fas fa-check-circle';
      }
      
      document.getElementById('notificationMessage').textContent = msg;
      
      setTimeout(() => notif.classList.remove('show'), 3000);
    }

    // Esconder notifica√ß√£o
    function hideNotification() {
      document.getElementById('notification').classList.remove('show');
    }

    // Verificar turno ativo ao carregar
    window.addEventListener('DOMContentLoaded', () => {
      const activeTurn = localStorage.getItem('activeTurn');
      if (activeTurn) {
        currentTurn = JSON.parse(activeTurn);
        document.getElementById('turnSelection').style.display = 'none';
        const mainApp = document.getElementById('mainApp');
        mainApp.style.display = 'flex';
        mainApp.classList.add('show');
        updateTurnInfo();
        loadCart();
      }
    });
  </script>
</body>
</html>