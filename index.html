<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caixa Freitas v9.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,sans-serif;background:#1a1a2e;height:100vh;overflow:hidden}button{cursor:pointer;border:none;transition:.3s}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.turn-selection{position:fixed;inset:0;background:linear-gradient(135deg,#4a1a2e,#2d0f1c);display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff;padding:20px}.turn-logo{width:90px;height:90px;background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.3);border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2.8rem;font-weight:800;margin-bottom:24px}.turn-title{font-size:2rem;font-weight:800;margin-bottom:12px}.turn-subtitle{font-size:1.05rem;opacity:.9;margin-bottom:36px}.turn-btn{background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.25);color:#fff;padding:20px 28px;border-radius:16px;font-size:1.15rem;font-weight:700;margin:0 8px}#mainApp{display:none;flex-direction:column;height:100vh;color:#2c3e50}#mainApp.show{display:flex;animation:fadeIn .5s}.header{background:linear-gradient(135deg,#4a1a2e,#2d0f1c);color:#fff;padding:12px;text-align:center}.header h1{font-size:1.5rem;font-weight:800}.turno-info{font-size:.8rem;background:rgba(255,255,255,.2);padding:4px 12px;border-radius:12px;margin-top:8px;display:inline-flex;gap:6px}.container{max-width:420px;margin:0 auto;padding:8px;flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:10px}.card{background:rgba(255,255,255,.95);border-radius:16px;padding:14px;box-shadow:0 8px 32px rgba(0,0,0,.12)}.section-title{font-size:1rem;font-weight:800;margin-bottom:12px;display:flex;align-items:center;gap:8px}.products-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}.product-btn{background:linear-gradient(135deg,#4a1a2e,#2d0f1c);color:#fff;border-radius:12px;padding:18px 12px;font-weight:700;min-height:70px;display:flex;flex-direction:column;gap:4px}.product-btn .price{font-size:.8rem;opacity:.95}.others-btn{background:linear-gradient(135deg,#FF9800,#F57C00)}.summary-list{min-height:120px;max-height:200px;overflow-y:auto;margin-bottom:12px;border:1px solid #dee2e6;border-radius:12px;padding:8px;background:rgba(248,249,250,.5)}.summary-item{display:grid;grid-template-columns:1fr auto auto;gap:10px;padding:12px;margin-bottom:6px;background:#fff;border-radius:12px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.08)}.summary-item.is-others{background:linear-gradient(135deg,rgba(255,249,196,.9),rgba(255,245,157,.9))}.item-label{font-weight:700;font-size:.9rem}.item-quantity{font-size:.8rem;color:#6c757d}.item-price{font-weight:800;color:#4a1a2e}.delete-btn{background:none;color:#E53935;padding:8px;border-radius:50%;width:36px;height:36px}.empty-cart{text-align:center;padding:24px;color:#6c757d}.empty-cart i{font-size:2.5rem;opacity:.3}.total-amount{font-size:1.5rem;font-weight:900;color:#4a1a2e;text-align:center;margin-bottom:14px;border:2px solid #4a1a2e;border-radius:12px;padding:12px;background:#fff}.payment-methods{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}.payment-btn{background:#fff;color:#2c3e50;border:2px solid #dee2e6;border-radius:12px;padding:14px;font-weight:700;display:flex;align-items:center;gap:8px;justify-content:center}.payment-btn.selected{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.received-section{margin-bottom:14px;display:none}.received-section.show{display:block}.received-input{width:100%;padding:14px;font-size:1.3rem;border:2px solid #F9A825;border-radius:12px;text-align:center;background:linear-gradient(135deg,rgba(255,249,196,.9),rgba(255,245,157,.9));font-weight:800;cursor:pointer}.change-amount{text-align:center;font-size:1.15rem;font-weight:800;color:#28a745;margin-top:10px;display:none}.action-buttons{display:grid;grid-template-columns:2fr 1fr 1fr;gap:10px;margin-bottom:14px}.action-buttons-row2{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}.action-btn{padding:14px 10px;border-radius:12px;font-size:.9rem;font-weight:800;display:flex;align-items:center;justify-content:center;gap:6px;min-height:54px}.next-btn{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.clear-btn{background:linear-gradient(135deg,#E53935,#d32f2f);color:#fff}.payment-supplier-btn{background:linear-gradient(135deg,#4a1a2e,#2d0f1c);color:#fff;font-size:.8rem}.sangria-btn{background:linear-gradient(135deg,#FF9800,#F57C00);color:#fff;font-size:.8rem}.close-turn-btn{background:linear-gradient(135deg,#6c757d,#424242);color:#fff;font-size:.8rem}.history-btn{background:linear-gradient(135deg,#6c757d,#424242);color:#fff;font-size:.85rem}.history-btn.pro{background:linear-gradient(135deg,#4a1a2e,#2d0f1c)}.modal-overlay{position:fixed;inset:0;background:rgba(26,26,46,.95);padding:20px;z-index:2000;display:none;justify-content:center;align-items:center;overflow-y:auto}.modal-overlay.show{display:flex}.modal-content{background:#fff;border-radius:24px;padding:24px;width:100%;max-width:500px;max-height:90vh;overflow-y:auto}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid #dee2e6}.modal-title{font-weight:800;font-size:1.4rem;display:flex;gap:10px}.modal-close{background:linear-gradient(135deg,#E53935,#d32f2f);color:#fff;font-size:1.3rem;padding:8px 12px;border-radius:10px;font-weight:bold}.form-group{margin-bottom:18px}.form-label{display:block;font-weight:700;margin-bottom:8px}.form-input{width:100%;padding:14px;border:2px solid #dee2e6;border-radius:12px;font-size:1rem}.form-input:focus{outline:none;border-color:#4a1a2e}.form-checkbox{display:flex;align-items:center;gap:10px;padding:14px;background:#f8f9fa;border-radius:12px;border:2px solid #dee2e6;cursor:pointer}.form-checkbox input{width:24px;height:24px}.form-checkbox label{font-weight:700;flex:1;cursor:pointer}.form-actions{display:grid;grid-template-columns:1fr 2fr;gap:12px;margin-top:24px}.btn-cancel{background:linear-gradient(135deg,#E53935,#d32f2f);color:#fff;padding:16px;border-radius:12px;font-weight:800}.btn-submit{background:linear-gradient(135deg,#28a745,#218838);color:#fff;padding:16px;border-radius:12px;font-weight:800}.history-list{display:flex;flex-direction:column;gap:12px;max-height:60vh;overflow-y:auto}.history-card{background:#fff;border-radius:12px;padding:16px;border:2px solid #dee2e6}.history-card.cash{border-left:4px solid #28a745}.history-card.card{border-left:4px solid #007bff}.history-header{display:flex;justify-content:space-between;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid #dee2e6}.history-time{font-weight:700}.history-payment{display:flex;align-items:center;gap:6px;font-weight:700;padding:6px 12px;border-radius:8px;font-size:.85rem}.history-payment.cash{background:rgba(40,167,69,.1);color:#28a745}.history-payment.card{background:rgba(0,123,255,.1);color:#007bff}.history-item{display:flex;justify-content:space-between;padding:6px 0;font-size:.9rem;color:#6c757d}.history-total{display:flex;justify-content:space-between;padding-top:12px;border-top:2px solid #dee2e6;font-weight:900;font-size:1.1rem;color:#4a1a2e}.btn-print{background:linear-gradient(135deg,#4a1a2e,#2d0f1c);color:#fff;padding:10px;border-radius:8px;font-weight:700;margin-top:12px;display:flex;align-items:center;justify-content:center;gap:6px}.summary-box{background:linear-gradient(135deg,rgba(74,26,46,.1),rgba(107,40,67,.1));border-radius:12px;padding:16px;margin-bottom:20px;border:2px solid rgba(74,26,46,.3)}.summary-row{display:flex;justify-content:space-between;margin-bottom:10px}.summary-row.total{font-size:1.3rem;font-weight:900;color:#4a1a2e;padding-top:10px;border-top:2px solid rgba(74,26,46,.3);margin-top:10px}.virtual-keyboard{position:fixed;inset:0;background:rgba(26,26,46,.95);padding:20px;z-index:3000;display:none;justify-content:center;align-items:center}.virtual-keyboard.show{display:flex}.keyboard-container{background:#fff;border-radius:24px;padding:24px;width:100%;max-width:400px}.keyboard-header{display:flex;justify-content:space-between;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid #dee2e6}.keyboard-title{font-weight:800}.keyboard-close{background:linear-gradient(135deg,#E53935,#d32f2f);color:#fff;padding:8px 12px;border-radius:10px;font-weight:bold}.keyboard-display{background:linear-gradient(135deg,rgba(255,249,196,.9),rgba(255,245,157,.9));padding:18px;border-radius:12px;font-size:2rem;font-weight:900;text-align:center;margin-bottom:20px;border:3px solid #F9A825;min-height:75px;display:flex;align-items:center;justify-content:center;color:#4a1a2e}.keyboard-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}.keyboard-btn{aspect-ratio:1;font-size:1.5rem;font-weight:800;border-radius:12px;background:linear-gradient(135deg,#4a1a2e,#2d0f1c);color:#fff;min-height:64px}.keyboard-actions{display:grid;grid-template-columns:1fr 2fr;gap:12px}.keyboard-cancel,.keyboard-confirm{border-radius:12px;padding:18px;font-weight:800}.keyboard-cancel{background:linear-gradient(135deg,#E53935,#d32f2f);color:#fff}.keyboard-confirm{background:linear-gradient(135deg,#28a745,#218838);color:#fff}.notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#fff;border-radius:16px;padding:18px 24px;box-shadow:0 8px 32px rgba(0,0,0,.2);z-index:3000;display:none;align-items:center;gap:14px;min-width:300px}.notification.show{display:flex}.notification.error{border-left:4px solid #E53935}.notification.warning{border-left:4px solid #FF9800}.notification.success{border-left:4px solid #28a745}.notification-icon{font-size:1.5rem}.notification.error .notification-icon{color:#E53935}.notification.warning .notification-icon{color:#FF9800}.notification.success .notification-icon{color:#28a745}.notification-message{flex:1;font-weight:700}</style>
</head>
<body>
<div class="turn-selection" id="turnSelection">
<div class="turn-logo">F</div>
<h2 class="turn-title">Bem-vindo ao Caixa Freitas</h2>
<p class="turn-subtitle">Selecione o turno para come√ßar</p>
<div><button class="turn-btn" onclick="startTurn('morning')">‚òÄÔ∏è Turno da Manh√£</button><button class="turn-btn" onclick="startTurn('afternoon')">üåÖ Turno da Tarde</button></div>
</div>
<div id="mainApp">
<header class="header">
<h1>Caixa Freitas</h1>
<div class="turno-info"><i class="fas fa-clock"></i><span id="turnText">...</span></div>
</header>
<div class="container">
<section class="card">
<h3 class="section-title"><i class="fas fa-bread-slice"></i> Produtos</h3>
<div class="products-grid">
<button class="product-btn" onclick="addProduct('P√£o de Sal',0.70)"><span>P√£o de Sal</span><span class="price">R$ 0,70</span></button>
<button class="product-btn" onclick="addProduct('P√£o Doce Comum',0.70)"><span>P√£o Doce Comum</span><span class="price">R$ 0,70</span></button>
<button class="product-btn" onclick="addProduct('P√£o Doce Especial',0.80)"><span>P√£o Doce Especial</span><span class="price">R$ 0,80</span></button>
<button class="product-btn others-btn" onclick="openKeyboard('others')"><span>Outros</span></button>
</div>
</section>
<section class="card">
<h3 class="section-title"><i class="fas fa-shopping-cart"></i> Pedido</h3>
<div class="summary-list" id="summaryList"><div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Nenhum item adicionado</p></div></div>
<div class="total-amount"><span id="totalAmount">R$ 0,00</span></div>
<h4 class="section-title"><i class="fas fa-credit-card"></i> Pagamento</h4>
<div class="payment-methods">
<button class="payment-btn" onclick="selectPayment('Cash')"><i class="fas fa-money-bill-wave"></i> Dinheiro</button>
<button class="payment-btn" onclick="selectPayment('Card/PIX')"><i class="fas fa-credit-card"></i> Cart√£o/PIX</button>
</div>
<div class="received-section" id="receivedSection">
<input type="text" class="received-input" id="receivedInput" placeholder="Valor recebido" readonly onclick="openReceivedKeyboard()">
<div class="change-amount" id="changeAmount"></div>
</div>
<div class="action-buttons">
<button class="action-btn next-btn" onclick="processNext()"><i class="fas fa-check"></i> Pr√≥ximo</button>
<button class="action-btn clear-btn" onclick="clearCart()"><i class="fas fa-trash"></i> Limpar</button>
<button class="action-btn payment-supplier-btn" onclick="openPaymentModal()"><i class="fas fa-hand-holding-usd"></i> Pagar</button>
</div>
<div class="action-buttons-row2">
<button class="action-btn sangria-btn" onclick="openWithdrawalModal()"><i class="fas fa-money-bill-wave"></i> Sangria</button>
<button class="action-btn close-turn-btn" onclick="closeTurn()"><i class="fas fa-times"></i> Fechar</button>
<button class="action-btn history-btn" onclick="openHistoryModal()"><i class="fas fa-history"></i> Hist√≥rico</button>
<button class="action-btn history-btn pro" onclick="showNotification('Em desenvolvimento','warning')"><i class="fas fa-chart-line"></i> Pro</button>
</div>
</section>
</div>
</div>
<div class="modal-overlay" id="paymentModal">
<div class="modal-content">
<div class="modal-header"><h3 class="modal-title"><i class="fas fa-hand-holding-usd"></i> Pagamento</h3><button class="modal-close" onclick="closePaymentModal()">√ó</button></div>
<form onsubmit="submitPayment(event)">
<div class="form-group"><label class="form-label">Fornecedor</label><input type="text" class="form-input" id="supplierName" required></div>
<div class="form-group"><label class="form-label">Valor</label><input type="text" class="form-input" id="paymentValue" required readonly onclick="openPaymentKeyboard()"></div>
<div class="form-group"><div class="form-checkbox"><input type="checkbox" id="fromCash"><label for="fromCash">Retirar do caixa</label></div></div>
<div class="form-actions"><button type="button" class="btn-cancel" onclick="closePaymentModal()">Cancelar</button><button type="submit" class="btn-submit">Registrar</button></div>
</form>
</div>
</div>
<div class="modal-overlay" id="withdrawalModal">
<div class="modal-content">
<div class="modal-header"><h3 class="modal-title"><i class="fas fa-money-bill-wave"></i> Sangria</h3><button class="modal-close" onclick="closeWithdrawalModal()">√ó</button></div>
<form onsubmit="submitWithdrawal(event)">
<div class="form-group"><label class="form-label">Valor</label><input type="text" class="form-input" id="withdrawalValue" required readonly onclick="openWithdrawalKeyboard()"></div>
<div class="form-group"><label class="form-label">Motivo</label><input type="text" class="form-input" id="withdrawalReason"></div>
<div class="form-actions"><button type="button" class="btn-cancel" onclick="closeWithdrawalModal()">Cancelar</button><button type="submit" class="btn-submit">Confirmar</button></div>
</form>
</div>
</div>
<div class="modal-overlay" id="historyModal">
<div class="modal-content">
<div class="modal-header"><h3 class="modal-title"><i class="fas fa-history"></i> Hist√≥rico</h3><button class="modal-close" onclick="closeHistoryModal()">√ó</button></div>
<div class="summary-box">
<div class="summary-row"><span>üíµ Dinheiro:</span><strong id="historyCash">R$ 0,00</strong></div>
<div class="summary-row"><span>üí≥ Cart√£o/PIX:</span><strong id="historyCard">R$ 0,00</strong></div>
<div class="summary-row"><span>üì§ Pagamentos:</span><strong id="historyPayments" style="color:#E53935">R$ 0,00</strong></div>
<div class="summary-row"><span>üì§ Sangrias:</span><strong id="historyWithdrawals" style="color:#E53935">R$ 0,00</strong></div>
<div class="summary-row total"><span>üí∞ Total:</span><span id="historyTotal">R$ 0,00</span></div>
<div class="summary-row"><span>üíµ Saldo:</span><strong id="historyCashBalance" style="color:#28a745">R$ 0,00</strong></div>
</div>
<h4 style="font-weight:800;margin-bottom:12px">Vendas</h4>
<div class="history-list" id="historyList"></div>
</div>
</div>
<div class="virtual-keyboard" id="virtualKeyboard">
<div class="keyboard-container">
<div class="keyboard-header"><span class="keyboard-title" id="keyboardTitle">Valor</span><button class="keyboard-close" onclick="closeKeyboard()">√ó</button></div>
<div class="keyboard-display" id="keyboardDisplay">0</div>
<div class="keyboard-grid">
<button class="keyboard-btn" onclick="inputDigit('1')">1</button>
<button class="keyboard-btn" onclick="inputDigit('2')">2</button>
<button class="keyboard-btn" onclick="inputDigit('3')">3</button>
<button class="keyboard-btn" onclick="inputDigit('4')">4</button>
<button class="keyboard-btn" onclick="inputDigit('5')">5</button>
<button class="keyboard-btn" onclick="inputDigit('6')">6</button>
<button class="keyboard-btn" onclick="inputDigit('7')">7</button>
<button class="keyboard-btn" onclick="inputDigit('8')">8</button>
<button class="keyboard-btn" onclick="inputDigit('9')">9</button>
<button class="keyboard-btn" onclick="inputComma()">,</button>
<button class="keyboard-btn" onclick="inputDigit('0')">0</button>
<button class="keyboard-btn" onclick="backspace()"><i class="fas fa-backspace"></i></button>
</div>
<div class="keyboard-actions"><button class="keyboard-cancel" onclick="closeKeyboard()">Cancelar</button><button class="keyboard-confirm" onclick="confirmKeyboard()">Confirmar</button></div>
</div>
</div>
<div class="notification" id="notification"><i class="notification-icon fas fa-check"></i><span class="notification-message" id="notificationMessage"></span><button class="notification-close" onclick="hideNotification()">√ó</button></div>
<script>
let cart=[],total=0,paymentMethod='',currentTurn=null,keyboardValue='',keyboardTarget=null,editIndex=null,isFirstDigit=!1;function startTurn(t){const e=new Date;currentTurn={type:t,startTime:e.toLocaleTimeString('pt-BR'),startDate:e.toLocaleDateString('pt-BR')},localStorage.setItem('activeTurn',JSON.stringify(currentTurn)),document.getElementById('turnSelection').style.display='none';const n=document.getElementById('mainApp');n.style.display='flex',n.classList.add('show'),updateTurnInfo(),loadCart()}function updateTurnInfo(){if(!currentTurn)return;const t=currentTurn.type==='morning'?'‚òÄÔ∏è':'üåÖ',e=currentTurn.type==='morning'?'Manh√£':'Tarde';document.getElementById('turnText').textContent=`${t} ${e} - ${currentTurn.startTime}`}function addProduct(t,e){const n=cart.find(n=>n.label===t&&n.price===e);n?n.quantity+=1:cart.push({label:t,price:e,quantity:1,isOthers:t==='Outros'}),updateDisplay()}function removeItem(t){cart.splice(t,1),updateDisplay()}function updateDisplay(){renderCart(),updateTotal(),saveCart()}function renderCart(){const t=document.getElementById('summaryList');if(cart.length===0)return void(t.innerHTML='<div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Nenhum item</p></div>');t.innerHTML=[...cart].reverse().map((t,e)=>{const n=cart.length-1-e;return`<div class="summary-item ${t.isOthers?'is-others':''}" onclick="editItem(${n})"><div><div class="item-label">${t.label}</div><div class="item-quantity">${t.quantity}x R$ ${t.price.toFixed(2).replace('.',',')}</div></div><div class="item-price">R$ ${(t.quantity*t.price).toFixed(2).replace('.',',')}</div><button class="delete-btn" onclick="event.stopPropagation();removeItem(${n})"><i class="fas fa-trash"></i></button></div>`}).join('')}function updateTotal(){total=cart.reduce((t,e)=>t+e.quantity*e.price,0),document.getElementById('totalAmount').textContent=`R$ ${total.toFixed(2).replace('.',',')}`,paymentMethod==='Card/PIX'&&(document.getElementById('receivedInput').value=total.toFixed(2).replace('.',',')),paymentMethod==='Cash'&&updateChange()}function selectPayment(t){paymentMethod=t,document.querySelectorAll('.payment-btn').forEach(t=>t.classList.remove('selected')),event.target.classList.add('selected');const e=document.getElementById('receivedSection'),n=document.getElementById('receivedInput'),s=document.getElementById('changeAmount');e.classList.add('show'),t==='Card/PIX'?(n.value=total.toFixed(2).replace('.',','),s.style.display='none'):(n.value='',s.style.display='block')}function updateChange(){const t=document.getElementById('receivedInput'),e=document.getElementById('changeAmount'),n=parseFloat(t.value.replace(',','.'))||0,s=n-total;s>=0?(e.textContent=`Troco: R$ ${s.toFixed(2).replace('.',',')}`,e.style.color='#28a745'):(e.textContent=`Falta: R$ ${Math.abs(s).toFixed(2).replace('.',',')}`,e.style.color='#E53935')}function clearCart(){confirm('Limpar carrinho?')&&(cart=[],total=0,paymentMethod='',updateDisplay(),document.querySelectorAll('.payment-btn').forEach(t=>t.classList.remove('selected')),document.getElementById('receivedSection').classList.remove('show'),document.getElementById('receivedInput').value='',document.getElementById('changeAmount').textContent='')}function processNext(){if(cart.length===0)return void showNotification('Adicione itens','warning');if(!paymentMethod)return void showNotification('Selecione o pagamento','warning');let t=total;if(paymentMethod==='Cash'){const e=document.getElementById('receivedInput');if(!e.value)return void showNotification('Informe o valor recebido','warning');if(t=parseFloat(e.value.replace(',','.'))||0,t<total)return void showNotification('Valor insuficiente','error')}saveSale(t),clearCartSilent(),showNotification('Venda processada!','success')}function clearCartSilent(){cart=[],total=0,paymentMethod='',updateDisplay(),document.querySelectorAll('.payment-btn').forEach(t=>t.classList.remove('selected')),document.getElementById('receivedSection').classList.remove('show'),document.getElementById('receivedInput').value='',document.getElementById('changeAmount').textContent=''}function saveSale(t){const e=new Date,n={id:Date.now(),items:[...cart],total:total,paymentMethod:paymentMethod,received:t,change:t-total,timestamp:e.toISOString(),date:e.toLocaleDateString('pt-BR'),time:e.toLocaleTimeString('pt-BR'),turn:currentTurn},s=JSON.parse(localStorage.getItem('salesHistory')||'[]');s.unshift(n),localStorage.setItem('salesHistory',JSON.stringify(s))}function saveCart(){localStorage.setItem('currentCart',JSON.stringify(cart))}function loadCart(){const t=localStorage.getItem('currentCart');t&&(cart=JSON.parse(t),updateDisplay())}function closeTurn(){if(!confirm('Fechar turno?'))return;const t=new Date,e={...currentTurn,endTime:t.toLocaleTimeString('pt-BR'),endDate:t.toLocaleDateString('pt-BR'),closed:!0},n=JSON.parse(localStorage.getItem('turnHistory')||'[]');n.unshift(e),localStorage.setItem('turnHistory',JSON.stringify(n)),localStorage.removeItem('activeTurn'),localStorage.removeItem('currentCart'),clearCartSilent(),document.getElementById('mainApp').style.display='none',document.getElementById('turnSelection').style.display='flex',showNotification('Turno fechado!','success')}function openPaymentModal(){document.getElementById('paymentModal').classList.add('show'),document.getElementById('supplierName').value='',document.getElementById('paymentValue').value='',document.getElementById('fromCash').checked=!1}function closePaymentModal(){document.getElementById('paymentModal').classList.remove('show')}function openPaymentKeyboard(){keyboardTarget='payment-value',keyboardValue='',isFirstDigit=!0,document.getElementById('keyboardTitle').textContent='Valor do pagamento',document.getElementById('keyboardDisplay').textContent='0',document.getElementById('virtualKeyboard').classList.add('show')}function submitPayment(t){t.preventDefault();const e=document.getElementById('supplierName').value.trim(),n=document.getElementById('paymentValue').value,s=document.getElementById('fromCash').checked;if(!e||!n)return void showNotification('Preencha os campos','warning');const a=parseFloat(n.replace(',','.'));if(isNaN(a)||a<=0)return void showNotification('Valor inv√°lido','error');if(s){const t=calculateCashBalance();if(a>t)return void showNotification(`Saldo insuficiente: R$ ${t.toFixed(2).replace('.',',')}`,'error');if(!confirm(`Retirar R$ ${a.toFixed(2).replace('.',',')} do caixa?`))return}const i=new Date,o={id:Date.now(),supplier:e,value:a,fromCash:s,timestamp:i.toISOString(),date:i.toLocaleDateString('pt-BR'),time:i.toLocaleTimeString('pt-BR'),turn:currentTurn},r=JSON.parse(localStorage.getItem('payments')||'[]');r.unshift(o),localStorage.setItem('payments',JSON.stringify(r)),closePaymentModal(),showNotification(`Pagamento registrado: ${e}`,'success')}function openWithdrawalModal(){document.getElementById('withdrawalModal').classList.add('show'),document.getElementById('withdrawalValue').value='',document.getElementById('withdrawalReason').value=''}function closeWithdrawalModal(){document.getElementById('withdrawalModal').classList.remove('show')}function openWithdrawalKeyboard(){keyboardTarget='withdrawal-value',keyboardValue='',isFirstDigit=!0,document.getElementById('keyboardTitle').textContent='Valor da sangria',document.getElementById('keyboardDisplay').textContent='0',document.getElementById('virtualKeyboard').classList.add('show')}function submitWithdrawal(t){t.preventDefault();const e=document.getElementById('withdrawalValue').value,n=document.getElementById('withdrawalReason').value.trim()||'Sangria geral';if(!e)return void showNotification('Informe o valor','warning');const s=parseFloat(e.replace(',','.'));if(isNaN(s)||s<=0)return void showNotification('Valor inv√°lido','error');const a=calculateCashBalance();if(s>a)return void showNotification(`Saldo insuficiente: R$ ${a.toFixed(2).replace('.',',')}`,'error');if(!confirm(`Sangria de R$ ${s.toFixed(2).replace('.',',')}?`))return;const i=new Date,o={id:Date.now(),value:s,reason:n,timestamp:i.toISOString(),date:i.toLocaleDateString('pt-BR'),time:i.toLocaleTimeString('pt-BR'),turn:currentTurn},r=JSON.parse(localStorage.getItem('withdrawals')||'[]');r.unshift(o),localStorage.setItem('withdrawals',JSON.stringify(r)),closeWithdrawalModal(),showNotification(`Sangria registrada: R$ ${s.toFixed(2).replace('.',',')}`,  'success')}function openHistoryModal(){document.getElementById('historyModal').classList.add('show'),renderHistory()}function closeHistoryModal(){document.getElementById('historyModal').classList.remove('show')}function renderHistory(){const t=getTurnSales(),e=getTurnPayments(),n=getTurnWithdrawals();let s=0,a=0,i=0,o=0;t.forEach(t=>{t.paymentMethod==='Cash'?s+=t.total:a+=t.total}),e.forEach(t=>{t.fromCash&&(i+=t.value)}),n.forEach(t=>{o+=t.value});const r=s+a,l=s-i-o;document.getElementById('historyCash').textContent=`R$ ${s.toFixed(2).replace('.',',')}`,document.getElementById('historyCard').textContent=`R$ ${a.toFixed(2).replace('.',',')}`,document.getElementById('historyPayments').textContent=`- R$ ${i.toFixed(2).replace('.',',')}`,document.getElementById('historyWithdrawals').textContent=`- R$ ${o.toFixed(2).replace('.',',')}`,document.getElementById('historyTotal').textContent=`R$ ${r.toFixed(2).replace('.',',')}`,document.getElementById('historyCashBalance').textContent=`R$ ${l.toFixed(2).replace('.',',')}`;const c=document.getElementById('historyList');if(t.length===0)return void(c.innerHTML='<div style="text-align:center;padding:40px;color:#6c757d"><i class="fas fa-shopping-cart" style="font-size:3rem;opacity:.3"></i><p style="font-weight:700">Nenhuma venda</p></div>');c.innerHTML=t.map(t=>`<div class="history-card ${t.paymentMethod==='Cash'?'cash':'card'}"><div class="history-header"><span class="history-time"><i class="fas fa-clock"></i> ${t.time}</span><span class="history-payment ${t.paymentMethod==='Cash'?'cash':'card'}"><i class="fas fa-${t.paymentMethod==='Cash'?'money-bill-wave':'credit-card'}"></i> ${t.paymentMethod==='Cash'?'Dinheiro':'Cart√£o/PIX'}</span></div><div>${t.items.map(t=>`<div class="history-item"><span>${t.quantity}x ${t.label}</span><span>R$ ${(t.quantity*t.price).toFixed(2).replace('.',',')}</span></div>`).join('')}</div><div class="history-total"><span>Total:</span><span>R$ ${t.total.toFixed(2).replace('.',',')}</span></div>${t.paymentMethod==='Cash'&&t.change>0?`<div style="font-size:.85rem;color:#6c757d;margin-top:8px">Troco: R$ ${t.change.toFixed(2).replace('.',',')}</div>`:''}<button class="btn-print" onclick="printReceipt(${t.id})"><i class="fas fa-print"></i> Imprimir</button></div>`).join('')}function getTurnSales(){if(!currentTurn)return[];const t=JSON.parse(localStorage.getItem('salesHistory')||'[]');return t.filter(t=>t.turn&&t.turn.type===currentTurn.type&&t.turn.startTime===currentTurn.startTime)}function getTurnPayments(){if(!currentTurn)return[];const t=JSON.parse(localStorage.getItem('payments')||'[]');return t.filter(t=>t.turn&&t.turn.type===currentTurn.type&&t.turn.startTime===currentTurn.startTime)}function getTurnWithdrawals(){if(!currentTurn)return[];const t=JSON.parse(localStorage.getItem('withdrawals')||'[]');return t.filter(t=>t.turn&&t.turn.type===currentTurn.type&&t.turn.startTime===currentTurn.startTime)}function calculateCashBalance(){const t=getTurnSales(),e=getTurnPayments(),n=getTurnWithdrawals();let s=0;return t.forEach(t=>{t.paymentMethod==='Cash'&&(s+=t.total)}),e.forEach(t=>{t.fromCash&&(s-=t.value)}),n.forEach(t=>{s-=t.value}),s}function printReceipt(t){const e=JSON.parse(localStorage.getItem('salesHistory')||'[]'),n=e.find(e=>e.id===t);if(!n)return void showNotification('Venda n√£o encontrada','error');const s=`
========================================
        CAIXA FREITAS
========================================
Data: ${n.date}
Hora: ${n.time}
Turno: ${n.turn.type==='morning'?'Manh√£':'Tarde'}
========================================

ITENS:
${n.items.map(t=>`${t.quantity}x ${t.label.padEnd(20)} R$ ${(t.quantity*t.price).toFixed(2).replace('.',',')}`).join('\n')}
========================================
TOTAL:              R$ ${n.total.toFixed(2).replace('.',',')}
========================================
Pagamento: ${n.paymentMethod==='Cash'?'Dinheiro':'Cart√£o/PIX'}
${n.paymentMethod==='Cash'?`Recebido:           R$ ${n.received.toFixed(2).replace('.',',')}\nTroco:              R$ ${n.change.toFixed(2).replace('.',',')}`:''} 
========================================
      Obrigado pela prefer√™ncia!
========================================
      `,a=window.open('','','height=600,width=400');a.document.write('<html><head><title>Recibo</title>'),a.document.write('<style>body{font-family:monospace;font-size:12px;white-space:pre;margin:20px}</style>'),a.document.write('</head><body>'),a.document.write(s),a.document.write('</body></html>'),a.document.close(),a.print(),showNotification('Recibo enviado','success')}function openKeyboard(t){keyboardTarget=t,keyboardValue='',editIndex=null,isFirstDigit=!0;const e=t==='others'?'Inserir pre√ßo do produto':'Inserir valor';document.getElementById('keyboardTitle').textContent=e,document.getElementById('keyboardDisplay').textContent='0',document.getElementById('virtualKeyboard').classList.add('show')}function openReceivedKeyboard(){paymentMethod==='Cash'&&(openKeyboard('received'),document.getElementById('keyboardTitle').textContent='Valor recebido')}function closeKeyboard(){document.getElementById('virtualKeyboard').classList.remove('show'),keyboardValue='',keyboardTarget=null,editIndex=null,isFirstDigit=!1}function inputDigit(t){isFirstDigit&&(keyboardValue='',isFirstDigit=!1),keyboardValue+=t,updateKeyboardDisplay()}function inputComma(){isFirstDigit&&(keyboardValue='0',isFirstDigit=!1),!keyboardValue.includes(',')&&keyboardValue.length>0&&(keyboardValue+=',',updateKeyboardDisplay())}function backspace(){keyboardValue=keyboardValue.slice(0,-1),updateKeyboardDisplay(),keyboardValue===''&&(isFirstDigit=!0)}function updateKeyboardDisplay(){document.getElementById('keyboardDisplay').textContent=keyboardValue||'0'}function confirmKeyboard(){const t=parseFloat(keyboardValue.replace(',','.'));if(isNaN(t)||t<=0)return void showNotification('Valor inv√°lido','warning');if(keyboardTarget==='others')addProduct('Outros',t);else if(keyboardTarget==='received')document.getElementById('receivedInput').value=t.toFixed(2).replace('.',','),updateChange();else if(keyboardTarget==='edit-quantity'){const e=parseInt(keyboardValue);e>0&&null!==editIndex&&(cart[editIndex].quantity=e,updateDisplay())}else if(keyboardTarget==='edit-price')t>0&&null!==editIndex&&(cart[editIndex].price=t,updateDisplay());else if(keyboardTarget==='payment-value')document.getElementById('paymentValue').value=t.toFixed(2).replace('.',',');else if(keyboardTarget==='withdrawal-value')document.getElementById('withdrawalValue').value=t.toFixed(2).replace('.',',');closeKeyboard()}function editItem(t){const e=cart[t];e&&(editIndex=t,isFirstDigit=!0,e.isOthers?(keyboardTarget='edit-price',keyboardValue=e.price.toFixed(2).replace('.',','),document.getElementById('keyboardTitle').textContent='Editar pre√ßo: Outros',document.getElementById('keyboardDisplay').textContent=keyboardValue):(keyboardTarget='edit-quantity',keyboardValue=e.quantity.toString(),document.getElementById('keyboardTitle').textContent='Editar qtd: '+e.label,document.getElementById('keyboardDisplay').textContent=keyboardValue),document.getElementById('virtualKeyboard').classList.add('show'))}function showNotification(t,e){const n=document.getElementById('notification'),s=n.querySelector('.notification-icon');n.className='notification '+e+' show',s.className='notification-icon fas fa-'+('error'===e?'times-circle':'warning'===e?'exclamation-triangle':'check-circle'),document.getElementById('notificationMessage').textContent=t,setTimeout(()=>n.classList.remove('show'),3e3)}function hideNotification(){document.getElementById('notification').classList.remove('show')}window.addEventListener('DOMContentLoaded',()=>{const t=localStorage.getItem('activeTurn');if(t){currentTurn=JSON.parse(t),document.getElementById('turnSelection').style.display='none';const e=document.getElementById('mainApp');e.style.display='flex',e.classList.add('show'),updateTurnInfo(),loadCart()}});
</script>
</body>
</html>